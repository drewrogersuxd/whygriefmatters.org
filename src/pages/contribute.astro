---
import { actions } from "astro:actions";

import { SignedIn, SignedOut } from "@clerk/astro/components";

import MainLayout from "@layouts/MainLayout.astro";
import AccountButton from "@ui/AccountButton.astro";
import Heading from "@ui/primitives/Heading.astro";
import Text from "@ui/primitives/Text.astro";

export const prerender = false;
---

<MainLayout>
  <div class:list={["xl:max-w-screen-lg xl:mx-auto p-3"]}>
    <SignedIn>
      <Text>Evaluate resources</Text>
      <form
        data-eval-submit
        method="POST"
        action={actions.evaluation.upsertEvaluation}
      >
        <label
          >Resource ID <input
            id="resourceID"
            name="resourceID"
            required
            type="text"
          /></label
        >
        <label
          >Rating <input
            id="rating"
            name="rating"
            required
            type="number"
            min="1"
            max="10"
          /></label
        >
        <button>Submit</button>
      </form>
    </SignedIn>
    <SignedOut>
      <Heading as="h1" size="xl5">Contribute</Heading>
      <Text>Contribute to the Why Grief Matters project</Text>
      <div class="w-64 mt-6">
        <AccountButton />
      </div>
    </SignedOut>
  </div>
</MainLayout>

<script>
  document.querySelectorAll("form[data-eval-submit]").forEach((form) => {
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const formElement = e.target as HTMLFormElement;
      const formData = new FormData(formElement);

      await fetch(formElement.action, {
        method: "POST",
        body: formData,
      });
    });
  });
</script>
