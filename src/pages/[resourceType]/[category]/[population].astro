---
import {
  type InternetResourcePageListing,
  internetResourceTypes,
} from "@model/internetResource";

import { getPopulations, getCategoryPagesData } from "@common/client";

import MainLayout from "@layouts/MainLayout.astro";
import ResourcePageListing from "@ui/ResourcePageListing.astro";

interface Props {
  resources: Array<InternetResourcePageListing>;
}

export async function getStaticPaths() {
  const categoryPagesData = await getCategoryPagesData();
  const populations = await getPopulations();

  return internetResourceTypes.flatMap((resourceType) =>
    populations.flatMap((population) =>
      categoryPagesData
        .filter(
          (data) =>
            data.resources &&
            data.resources.some(
              (r) =>
                r.type === resourceType &&
                r.populations?.includes(population.slug),
            ),
        )
        .map((data) => ({
          params: {
            category: data.slug,
            resourceType,
            population: population.slug,
          },
          props: {
            resources: data.resources.filter(
              (r) =>
                r.type === resourceType &&
                r.populations?.includes(population.slug),
            ),
          },
        })),
    ),
  );
}

const props = Astro.props;
---

<MainLayout>
  <section>
    <ul>
      {
        props.resources.map((resource) => (
          <li class="mb-6">
            <ResourcePageListing resource={resource} />
          </li>
        ))
      }
    </ul>
  </section>
</MainLayout>
