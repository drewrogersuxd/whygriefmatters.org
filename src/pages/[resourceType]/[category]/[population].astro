---
import {
  getCategory,
  getCategorySlugs,
  getInternetResources,
  getPopulation,
  getPopulationSlugs,
} from "@common/client";

import { INTERNET_RESOURCE_TYPES } from "@model/common";

import MainLayout from "@layouts/MainLayout.astro";
import ResourcePageLayout from "@layouts/ResourcePageLayout.astro";

import Resource from "@ui/Resource.astro";

export async function getStaticPaths() {
  const categorySlugs = await getCategorySlugs();
  const populationSlugs = await getPopulationSlugs();

  return [
    ...INTERNET_RESOURCE_TYPES.flatMap((resourceType) =>
      categorySlugs.flatMap((category) =>
        populationSlugs.map((population) => ({
          params: { resourceType, category, population },
        })),
      ),
    ),
  ];
}

const params = Astro.params;

const resources = await getInternetResources({
  resourceType: params.resourceType,
  categorySlug: params.category,
  populationSlug: params.population,
});

const category = await getCategory(params.category);
const population = await getPopulation(params.population);
---

<MainLayout>
  <ResourcePageLayout
    resourceType={params.resourceType}
    category={category}
    population={population}
  >
    <ul>
      {
        resources?.map((resource) => (
          <li>
            <Resource resource={resource} />
          </li>
        ))
      }
    </ul>
  </ResourcePageLayout>
</MainLayout>
